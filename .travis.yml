sudo: required
services:
- docker
before_script:
- docker pull navikt/glide
- docker pull golang:1.8
- docker pull navikt/helm
- docker login -u $DOCKER_USER -p $DOCKER_PASSWORD
- git clone https://github.com/nais/charts
script:
- make install test linux cli-dist
- "/bin/bash bump.sh $GH_TOKEN"
- git tag -a $(/bin/cat ./version) -m "auto-tag from Makefile [skip ci]" && git push
  --tags https://$GH_TOKEN@github.com/nais/named
- make docker-build push-dockerhub
- cd charts
- docker run -v $(pwd):/charts -v $(pwd)/../:/named -w /charts navikt/helm package
  /named/helm/named
- docker run -v $(pwd):/charts -w /charts navikt/helm repo index --url https://nais.github.io/charts
  .
- echo "<html><body><pre>$(cat index.yaml)</pre></body></html>" > index.html
- git add --all
- git commit -m "auto-update by travis [skip ci]"
- git push https://$GH_TOKEN@github.com/nais/charts
- cd ..
deploy:
  provider: releases
  api_key: "$GH_TOKEN"
  file_glob: true
  file: nais-*
  skip_cleanup: true
  on:
    branch: master
branches:
  only:
  - master
notifications:
  slack:
    secure: xYTqHowKT9fkEz3hnd8q3uJGIW+clEUwOxc46tg/s0k5/0KzRS1BdvbLM6AWN4zpTII9AHiYU8mE39vICNXUrrLs7xhRm/gXOiACplGvdbvMliUY9jBDRW2N8muexz1sqTqy5qFp/vmJKHqeQKGSkamyE4Bv8Tg/0MnJMx6piNj8NqLWWiuosJbvt4kY6ZInB33NTrt7AQuaqnHPrL0eADQNxORNHDbnOsmVl7ApswEnUndEZ+h6abXgZAIelFhJTuOYnH2Py+XpcdxPNK7udy/qL78Aji1WrDxKMnY+Lhq1jhQGez0hMlpZyoaLVNkh5ZhWIgJB3zI3rg9ndNKEqGL0MreRsm2h1yFQMPMzItJ3xcsi8OWi62P8cA1AKFpzEZAZuZN+bOKStWdDUwOOeQXbYb137Fs7l8da2Wx+JuQc0FsxFqYSV5fV0aXjviNa16eB8xsUOKCx7fU3O9CTkxdqn+Evn1RMSCvSVlJwv3v+SESg+17TCFxk+m7AqJxPiewqzqODqY2WHOiQAGHT2x7vVp2QH0gqOBWYjXT+UyFFS6Mq7fzXx49wbBrOBzCnnURSWJ1k1/HGNyU19pFI95PDinhLrwVQ9ZzZ5ewm5W41vI/tHKZyIim9v4lpYByznMu0AlJ6PuWaNL5I1tnvbn9OPPDU8eWMpoDmelr7Tgk=
env:
  global:
    secure: dNNQJboMnE2PhFgrPBlcixXHW9JGgZsUv6Z44uMa7+2KWev5ZaINE68/Q0b7xiZ6Z4CmV/PfyHYwcyOrhpSd8kVjD6SAh8eyMQmTU95KP1RtHl+cSCXeBCmq2zGLkvMGZC3MyGneVWELUP1fqcWEKZyIbZUL8J6q7+RhApDU61z+s5B+W+JajKj9+KWXz6+yNwoJuoeCOHedIwFSLLZGtunJu3Xpm9i5SpKDWHitjKzUUsRh5mfvtbmGPu0ia4pwMJjxNCFqbHuACEQwNOHpp1/L2KAjEzrl/cgZdmrM/RbFIm9OOebUzzY2qquOz6Wg5YeqL5uOXgJf0Z/uCDETw2n718PYBquWwaz7dzew3/YTTyR9EHEnJU9fwjqOFyVa1kQuyUUeo6bK3FvkXBUBEAQ5NiCsEaDEzF0FDw7IFj+ho7PjcqiPO/5t2w6QcPijoURaOt9EyBUg1HQb4uCVhqKv0f/tTRR2ZoMGiF1ZtAVxLwVW17orKPJtcYlioMTaCdR0sS/Ci3RTQx9hOl91OXnP2Zq3YyTEubpe6WRRZxv6ZVqqlu3D4/SAI4BfdkFQU5yQhnry4nQ4l2sSu8QkZ1jJh9jMrlhKJijN75ctn13psWHs9tox8GDhJFrLpGnKyaRyVu/DWgZL4ZD80bBmSOw/tzFSn1VbtwxxJY143iY=
